!function(t){"use strict";function e(t){if(!(this instanceof e))throw new TypeError("Promise is intended to be called as a constructor");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var r=this,i=r._handler=new n;try{t(function(t){i.resolve(t)},function(t){i.reject(t)})}catch(t){i.reject(t)}}function n(){this.state=0,this.callbacks=[],this.errbacks=[],this.result=void 0,this.reason=void 0}function r(t,e,n,r){return function(i){var o;try{o=r.call(void 0,i)}catch(t){return void n(t)}return o===t?void n(new TypeError("Cannot resolve a promise with itself")):void e(o)}}function i(t,e){o(t)&&(t=[t]),t.forEach(function(t){setTimeout(function(){t.call(void 0,e)})})}function o(t){return"function"==typeof t}function s(t){if(!t||"object"!=typeof t&&"function"!=typeof t)return!1;var e=t.then;return o(e)&&e}e.prototype.then=function(t,n){var i,s,c=new e(function(t,e){i=t,s=e});return this._handler.then(o(t)?r(c,i,s,t):i,o(n)?r(c,i,s,n):s),c},n.prototype={constructor:n,then:function(t,e){this.callbacks.push(t),this.errbacks.push(e),2===this.state&&i(t,this.result),3===this.state&&i(e,this.reason)},resolve:function(t,e){if(!(this.state>1&&1!==e)){var n;try{n=s(t)}catch(t){return void this.reject(t)}if(n)return void this.follow(t,n);this.state=2,this.result=t,i(this.callbacks,t)}},reject:function(t,e){this.state>1&&1!==e||(this.state=3,this.reason=t,i(this.errbacks,t))},follow:function(t,e){var n=this;n.state=1;var r=0;try{e.call(t,function(t){n.resolve(t,++r)},function(t){n.reject(t,++r)})}catch(t){n.reject(t,++r)}}},"undefined"!=typeof module?module.exports=e:t.Promise=e}(this);