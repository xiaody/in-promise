!function(t,e){"use strict";function n(t){if(!(this instanceof n))throw new TypeError("Promise shall be called as a constructor");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var e=this._handler=new r;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(o){e.reject(o)}}function r(){this.state=0,this.callbacks=[],this.errbacks=[],this.result=void 0,this.reason=void 0}function o(t,n,r,o){return function(i){var s;try{s=o.call(e,i)}catch(c){return void r(c)}return s===t?void r(new TypeError("Cannot resolve a promise with itself")):void n(s)}}function i(t,n){s(t)&&(t=[t]);for(var r=0,o=t.length;o>r;r++)!function(t){setTimeout(function(){t.call(e,n)},0)}(t[r]);t.length=0}function s(t){return"function"==typeof t}function c(t){if(!t||"object"!=typeof t&&!s(t))return!1;var e=t.then;return s(e)&&function(n,r){e.call(t,n,r)}}n.prototype.then=function(t,e){var r,i,c=new n(function(t,e){r=t,i=e});return this._handler.then(s(t)?o(c,r,i,t):r,s(e)?o(c,r,i,e):i),c},r.prototype={constructor:r,then:function(t,e){2===this.state?i(t,this.result):3===this.state?i(e,this.reason):(this.callbacks.push(t),this.errbacks.push(e))},resolve:function(t){if(!(this.state>1)){var e;try{e=c(t)}catch(n){return void this.reject(n)}if(e)return void this.follow(e);this.state=2,this.result=t,i(this.callbacks,t)}},reject:function(t){this.state>1||(this.state=3,this.reason=t,i(this.errbacks,t))},follow:function(t){this.state=1;var e=this,n=!0;try{t(function(t){n&&e.resolve(t),n=!1},function(t){n&&e.reject(t),n=!1})}catch(r){n&&e.reject(r),n=!1}}},"object"==typeof module?module.exports=n:t.Promise=n}(this);