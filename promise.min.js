!function(t){"use strict";function e(t){if(!(this instanceof e))throw new TypeError("Promise is intended to be called as a constructor");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var n=this,i=n._handler=new r;try{t(function(t){i.resolve(t)},function(t){i.reject(t)})}catch(t){i.reject(t)}}function r(){this.state=0,this.callbacks=[],this.errbacks=[],this.result=void 0,this.reason=void 0}function n(t,e,r,n){return function(i){var o;try{o=n.call(void 0,i)}catch(t){return void r(t)}return o===t?void r(new TypeError("Cannot resolve a promise with itself")):void e(o)}}function i(t,e){o(t)&&(t=[t]),t.forEach(function(t){setTimeout(function(){t.call(void 0,e)})})}function o(t){return"function"==typeof t}function s(t){if(!t||"object"!=typeof t&&"function"!=typeof t)return!1;var e=t.then;return o(e)&&e}e.prototype.then=function(t,r){var i,s,c=new e(function(t,e){i=t,s=e});return this._handler.then(o(t)?n(c,i,s,t):i,o(r)?n(c,i,s,r):s),c},r.prototype={constructor:r,then:function(t,e){this.callbacks.push(t),this.errbacks.push(e),2===this.state&&i(t,this.result),3===this.state&&i(e,this.reason)},resolve:function(t,e){if(!(this.state>1&&1!==e)){var r;try{r=s(t)}catch(t){return void this.reject(t)}if(r)return void this.follow(t,r);this.state=2,this.result=t,i(this.callbacks,t)}},reject:function(t,e){if(!(this.state>1&&1!==e)){var r;try{r=s(t)}catch(t){return void this.reject(t)}if(r)return void this.follow(t,r);this.state=3,this.reason=t,i(this.errbacks,t)}},follow:function(t,e){var r=this;r.state=1;var n=0;try{e.call(t,function(t){r.resolve(t,++n)},function(t){r.reject(t,++n)})}catch(t){r.reject(t,++n)}}},"undefined"!=typeof module?module.exports=e:t.Promise=e}(this);