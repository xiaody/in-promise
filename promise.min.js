!function(t){"use strict";function e(t){if(!(this instanceof e))throw new TypeError("Promise shall be called as a constructor");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var r=this._handler=new n;try{t(function(t){r.resolve(t)},function(t){r.reject(t)})}catch(t){r.reject(t)}}function n(){this.state=0,this.callbacks=[],this.errbacks=[],this.result=void 0,this.reason=void 0}function r(t,e,n,r){return function(i){var o;try{o=r.call(void 0,i)}catch(t){return void n(t)}return o===t?void n(new TypeError("Cannot resolve a promise with itself")):void e(o)}}function i(t,e){o(t)&&(t=[t]),t.forEach(function(t){setTimeout(function(){t.call(void 0,e)})})}function o(t){return"function"==typeof t}function s(t){if(!t||"object"!=typeof t&&!o(t))return!1;var e=t.then;return o(e)&&e.bind(t)}e.prototype.then=function(t,n){var i,s,c=new e(function(t,e){i=t,s=e});return this._handler.then(o(t)?r(c,i,s,t):i,o(n)?r(c,i,s,n):s),c},n.prototype={constructor:n,then:function(t,e){this.callbacks.push(t),this.errbacks.push(e),2===this.state&&i(t,this.result),3===this.state&&i(e,this.reason)},resolve:function(t,e){if(!this.state||1===e){var n;try{n=s(t)}catch(t){return void this.reject(t,1)}if(n)return void this.follow(n);this.state=2,this.result=t,i(this.callbacks,t)}},reject:function(t,e){this.state&&1!==e||(this.state=3,this.reason=t,i(this.errbacks,t))},follow:function(t){var e=this;e.state=1;var n=0;try{t(function(t){e.resolve(t,++n)},function(t){e.reject(t,++n)})}catch(t){e.reject(t,++n)}}},"undefined"!=typeof module?module.exports=e:t.Promise=e}(this);