!function(t,e){"use strict";function n(t){if(!(this instanceof n)||this._handler)throw new TypeError("Promise shall be called as a constructor");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var e=this._handler=new r;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(i){e.reject(i)}}function r(){this.state=0,this.callbacks=[],this.errbacks=[],this.result=void 0,this.reason=void 0}function i(t,n,r,i){return function(o){var s;try{s=i.call(e,o)}catch(c){return void r(c)}return s===t?void r(new TypeError("Cannot resolve a promise with itself")):void n(s)}}function o(t,n){s(t)&&(t=[t]);for(var r=0,i=t.length;i>r;r++)!function(t){setTimeout(function(){t.call(e,n)},0)}(t[r]);t.length=0}function s(t){return"function"==typeof t}function c(t){if(!t||"object"!=typeof t&&!s(t))return!1;var e=t.then;return s(e)&&function(n,r){e.call(t,n,r)}}n.prototype.then=function(t,e){var r,o,c=new n(function(t,e){r=t,o=e});return this._handler.then(s(t)?i(c,r,o,t):r,s(e)?i(c,r,o,e):o),c},r.prototype={constructor:r,then:function(t,e){2===this.state?o(t,this.result):3===this.state?o(e,this.reason):(this.callbacks.push(t),this.errbacks.push(e))},resolve:function(t){if(!(this.state>1)){var e;try{e=c(t)}catch(n){return void this.reject(n)}if(e)return void this.follow(e);this.state=2,this.result=t,o(this.callbacks,t)}},reject:function(t){this.state>1||(this.state=3,this.reason=t,o(this.errbacks,t))},follow:function(t){this.state=1;var e=this,n=!0;try{t(function(t){n&&e.resolve(t),n=!1},function(t){n&&e.reject(t),n=!1})}catch(r){n&&e.reject(r),n=!1}}},"object"==typeof module?module.exports=n:t.Promise=n}(this);